<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NJU2</title>
  <link rel="stylesheet" href="/stylesheets/bootstrap.css">
  <script type="text/javascript" src="/javascripts/jquery-2.1.4.js"></script>
  <script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>
  <link rel="stylesheet" href="/stylesheets/user.css">
  <script type="text/javascript" src="/javascripts/common.js"></script>
  <link rel="stylesheet" href="/stylesheets/common.css">
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
  <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>

</head>
<body>
  <%- include ../common/topNav %>
  <div class="setting-user col-md-8 col-md-offset-2">
    <ul class="nav nav-tabs" id="setting-tab">
      <li class="active" id="tab-data"><a href="#data">基本资料</a></li>
      <li id="tab-account"><a href="#account">账号和密码</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active update" id="data">
        <div class="info-tab">
          <span class="h4">姓名</span>
          <span class="user-info">
            <a id="name" data-type="text" data-url="/user/<%= user._id %>/name" data-title="修改姓名" data-id="name"><%= user.name %></a>
          </span>
        </div>
        <div class="info-tab">
          <span class="h4">院系</span>
          <span class="user-info"><%= user.major %><a class="glyphicon glyphicon-edit edit-name show_hidden">修改</a></span>
          <form action="/user/<%= user._id %>/major" method="post">
            <div class="form-group edited">
                <select name="major" class="selectpicker form-control" title="选择院系" data-live-search="true">
                  <optgroup label="文学院">
                    <option>文学系</option>
                    <option>语言学系</option>
                    <option>文献学系</option>
                    <option>戏剧影视艺术系</option>
                    <option>大学语文部</option>
                  </optgroup>
                  <optgroup label="历史学院">
                    <option>中国历史系</option>
                    <option>世界历史系</option>
                    <option>考古文物系</option>
                  </optgroup>
                  <optgroup label="哲学系（宗教学系）">
                    <option>哲学系（宗教学系）</option>
                  </optgroup>
                  <optgroup label="新闻传播学院">
                    <option>新闻与新媒体系</option>
                    <option>广播电影电视系</option>
                    <option>应用传播系</option>
                  </optgroup>
                  <optgroup label="法学院">
                    <option>法学院</option>
                  </optgroup>
                  <optgroup label="商学院">

                    <option>经济学院-经济学系</option>
                    <option>经济学院-国际经济贸易系</option>
                    <option>经济学院-金融与保险学系</option>
                    <option>经济学院-产业经济学系</option>
                    <option>经济学院-人口研究所</option>

                    <option>管理学院-工商管理系</option>
                    <option>管理学院-会计学系</option>
                    <option>管理学院-营销与电子商务系</option>
                    <option>管理学院-人力资源管理学系</option>
                  </optgroup>
                  <optgroup label="外国语学院">
                    <option>英语系</option>
                    <option>俄语系</option>
                    <option>日语系</option>
                    <option>德语系</option>
                    <option>法语系</option>
                    <option>西班牙语系</option>
                    <option>国际商务系</option>
                    <option>朝鲜语系</option>
                  </optgroup>
                  <optgroup label="政府管理学院">
                    <option>政治学系</option>
                    <option>行政管理学系</option>
                    <option>劳动人事与社会保障系</option>
                  </optgroup>
                  <optgroup label="信息管理学院">
                    <option>信息管理学院</option>
                  </optgroup>
                  <optgroup label="社会学院">
                    <option>社会学系</option>
                    <option>心理学系</option>
                    <option>社会工作与社会政策系</option>
                    <option>河仁社会慈善学院</option>
                  </optgroup>
                  <optgroup label="数学系">
                    <option>数学系</option>
                  </optgroup>
                  <optgroup label="物理学院">
                    <option>现代物理系</option>
                    <option>物理学系</option>
                    <option>光电科学系</option>
                    <option>声科学与工程系</option>
                    <option>基础物理教学中心</option>
                  </optgroup>
                  <optgroup label="天文与空间科学学院">
                    <option>天文与空间科学学院</option>
                  </optgroup>
                  <optgroup label="化学化工学院">
                    <option>化学化工学院</option>
                  </optgroup>
                  <optgroup label="计算机科学与技术系">
                    <option>计算机科学与技术系</option>
                  </optgroup>
                  <optgroup label="电子科学与工程学院">
                    <option>电子工程系</option>
                    <option>微电子与光电子学系</option>
                    <option>信息电子学系</option>
                    <option>通信工程系</option>
                    <option>电子电工实验教学中心</option>
                    <option>微制造与集成工艺中心</option>
                  </optgroup>
                  <optgroup label="现代工程与应用科学学院">
                    <option>材料科学与工程系</option>
                    <option>量子电子学与光学工程系</option>
                    <option>生物医学工程系</option>
                    <option>能源科学与工程系</option>
                  </optgroup>
                  <optgroup label="环境学院">
                    <option>环境科学系</option>
                    <option>环境工程系</option>
                    <option>环境规划与管理系</option>
                  </optgroup>
                  <optgroup label="地球科学与工程学院">
                    <option>地球科学系</option>
                    <option>水科学系</option>
                    <option>地质工程与信息技术系</option>
                  </optgroup>
                  <optgroup label="地理与海洋科学学院">
                    <option>国土资源与旅游学系</option>
                    <option>地理信息科学系</option>
                    <option>海岸海洋科学系</option>
                  </optgroup>
                  <optgroup label="大气科学学院">
                    <option>气象学系</option>
                    <option>大气物理学系</option>
                  </optgroup>
                  <optgroup label="生命科学学院">
                    <option>生物科学与技术系</option>
                    <option>生物化学系</option>
                  </optgroup>
                  <optgroup label="医学院">
                    <option>医学院</option>
                  </optgroup>
                  <optgroup label="工程管理学院">
                    <option>管理科学与工程系</option>
                    <option>控制与系统工程系</option>
                    <option>光通信工程研究中心</option>
                    <option>管理-控制-一体化实验教学中心</option>
                  </optgroup>
                  <optgroup label="匡亚明学院">
                    <option>匡亚明学院</option>
                  </optgroup>
                  <optgroup label="海外教育学院">
                    <option>海外教育学院</option>
                  </optgroup>
                  <optgroup label="软件学院">
                    <option>软件学院</option>
                  </optgroup>
                  <optgroup label="建筑与城市规划学院">
                    <option>建筑系</option>
                    <option>城市与区域规划系</option>
                  </optgroup>
                  <optgroup label="马克思主义学院">
                    <option>马克思主义学院</option>
                  </optgroup>
                  <optgroup label="创新创业学院">
                    <option>创新创业学院</option>
                  </optgroup>
                </select>
              <input type="submit" class="form-control submit" value="保存">
            </div>
          </form>
        </div>
        <div class="info-tab">
          <span class="h4">入学年份</span>
          <span class="user-info">
            <a id="year" data-url="/user/<%= user._id %>/year" data-type="combodate"
               data-format="YYYY" data-viewformat="YYYY" data-template="YYYY"
               data-title="修改入学年份" ><%= user.year %></a>
          </span>
        </div>
      </div>  
      <div class="tab-pane update" id="account">
        <div class="info-tab">
          <span class="h4">邮箱</span>
          <span class="user-info">
            <% if (!user.email) { %>
              <span style="color:#999;font-size:15px;">尚未注册邮箱</span>
            <% } else { %>
              <%= user.email %><a class="glyphicon glyphicon-edit edit-name show_hidden">修改</a></span>
            <% } %>
          <form action="/user/<%= user._id %>/email" method="post">
            <div class="form-group">
              <input type="text" name="email"class="form-control edited info" placeholder="邮箱">
            </div>
            <div class="form-group">
              <input type="submit" class="form-control edited submit" value="保存">
            </div>
          </form>
        </div>
        <div class="info-tab">
          <span class="h4">手机</span>
          <span class="user-info">
            <% if (!user.phone) { %>
              <span style="color:#999;font-size:15px;">尚未注册手机号码</span>
            <% } else { %>
              <%= user.phone %><a class="glyphicon glyphicon-edit edit-name show_hidden">修改</a>
            <% } %>
          </span>
          <form action="/user/<%= user._id %>/phone" method="post">
            <div class="form-group">
              <input type="text" name="phone"class="form-control edited info" placeholder="手机号码">
            </div>
            <div class="form-group">
              <input type="submit" class="form-control edited submit" value="保存">
            </div>
          </form>
        </div>
        <div class="info-tab">
          <span class="h4">密码</span>
          <span class="user-info"><a class="show_hidden">修改密码</a></span>
          <form action="/user/<%= user._id %>/password" method="post">
            <div class="form-group">
              <input type="text" name="originalPassword" class="form-control edited info" placeholder="输入原密码">
            </div>
            <div class="form-group">
              <input type="text" name="newPassword" class="form-control edited info" placeholder="新密码">
            </div>
            <div class="form-group">
              <input type="submit" class="form-control edited submit" value="保存">
            </div>
          </form>
        </div>
        <% if (updateErr) { %>
          <script>
            $('#setting-tab a[href="#account"]').tab('show');
          </script>
            <button class="label label-danger updateErr"><%= updateErr %></button>
        <% } %>
        <% if (success) { %>
          <script>
            $('#setting-tab a[href="#account"]').tab('show');
          </script>
            <button class="label label-danger updateErr"><%= success %></button>
        <% } %>            
      </div>   
    </div>
    <%- include ../common/footer %>
  </div>
  <script>
    $('#setting-tab a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    });
    $('.show_hidden').click(function () {
      // 这里不这么要写要多写很多遍啊。虽然很丑陋，但是暂时不知道怎么写好。
      var to_be_hidden = $(this).parent().siblings('form').children('.form-group');
      $(to_be_hidden).css({
        'display': 'block',
        'margin-top': '20px',
        'margin-left': '80px'
      });
      $('.updateErr').css({'display': 'none'});
    });
    $.fn.editable.defaults.mode = 'inline';
    $(document).ready(function() {
      $('#name').editable({
        send: 'always',
        success: function(response, newValue) {
          location.reload();
        }
      });

      $('#year').editable({
        send: 'always',
        success: function(response, newValue) {
          location.reload();
        }
      });
    });
  </script>
</body>
</html>
